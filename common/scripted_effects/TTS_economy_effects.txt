heavy_machinery_factory_count = {

every_owned_state ={
			set_temp_variable = { temphmf = THIS.building_level@heavy_machinery_factory }
			set_temp_variable = { tempsteel = THIS.resource@steel }
			set_temp_variable = { tempcrystals = THIS.resource@crystals }
			set_temp_variable = { temphm = THIS.resource@heavy_machinery }
			if = {
				limit = {
					check_variable = { temphmf = 0 }
				}
				
				
				set_building_level = {
    				type = no_heavy_machinery_factory
    				level = temphmf
    				instant_build = yes
				}
				
			}
			if = {
				limit = {
					check_variable = { temphmf > 0}
					OR = {
						check_variable = { tempsteel < 0 }
						check_variable = { tempcrystals < 0 }
					}
					check_variable = { temphm > 1 }
				}
				
				
				set_building_level = {
    				type = no_heavy_machinery_factory
    				level = temphmf
    				instant_build = yes
				}
				
			}
			else_if = {
				limit = {
					check_variable = { temphmf > 0}
					check_variable = { tempsteel > -1 }
					check_variable = { tempcrystals > -1 }
					check_variable = { temphm < 0 }
				}
				set_temp_variable = { temp2 = THIS.building_level@heavy_machinery_factory }
				multiply_temp_variable = {
					var = temp2
    				value = -1
				}
				set_building_level = {
    				type = no_heavy_machinery_factory
    				level = temp2
    				instant_build = yes
				}
				
			}
			
		}
}